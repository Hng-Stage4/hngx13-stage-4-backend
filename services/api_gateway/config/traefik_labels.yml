# Traefik labels for API Gateway service
# These can be used in docker-compose.yml

labels:
  # Enable Traefik for this service
  - "traefik.enable=true"
  
  # HTTP Router configuration
  - "traefik.http.routers.api-gateway.rule=PathPrefix(`/api`)"
  - "traefik.http.routers.api-gateway.entrypoints=websecure"
  - "traefik.http.routers.api-gateway.tls=true"
  - "traefik.http.routers.api-gateway.tls.certresolver=letsencrypt"
  
  # Service configuration
  - "traefik.http.services.api-gateway.loadbalancer.server.port=8000"
  - "traefik.http.services.api-gateway.loadbalancer.server.scheme=http"
  
  # Middleware configuration
  - "traefik.http.routers.api-gateway.middlewares=api-gateway-auth,rate-limit,cors-headers"
  
  # Auth middleware (ForwardAuth to /auth/verify)
  - "traefik.http.middlewares.api-gateway-auth.forwardauth.address=http://api_gateway:8000/api/v1/auth/verify"
  - "traefik.http.middlewares.api-gateway-auth.forwardauth.authResponseHeaders=X-User-Id,X-User-Role,X-User-Email"
  
  # Rate limiting
  - "traefik.http.middlewares.rate-limit.ratelimit.average=100"
  - "traefik.http.middlewares.rate-limit.ratelimit.burst=50"
  - "traefik.http.middlewares.rate-limit.ratelimit.period=1m"
  
  # CORS headers
  - "traefik.http.middlewares.cors-headers.headers.accesscontrolallowmethods=GET,POST,PUT,DELETE,PATCH,OPTIONS"
  - "traefik.http.middlewares.cors-headers.headers.accesscontrolalloworiginlist=*"
  - "traefik.http.middlewares.cors-headers.headers.accesscontrolmaxage=100"
  - "traefik.http.middlewares.cors-headers.headers.addvaryheader=true"
  
  # Health check
  - "traefik.http.services.api-gateway.loadbalancer.healthcheck.path=/health"
  - "traefik.http.services.api-gateway.loadbalancer.healthcheck.interval=30s"
  - "traefik.http.services.api-gateway.loadbalancer.healthcheck.timeout=5s"
  
  # Watchtower (for auto-updates)
  - "com.centurylinklabs.watchtower.enable=true"